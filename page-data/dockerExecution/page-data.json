{"componentChunkName":"component---src-templates-blog-post-js","path":"/dockerExecution/","result":{"data":{"site":{"siteMetadata":{"title":"Camveloper blog"}},"markdownRemark":{"id":"0d32a797-6da8-59f1-ba88-bf62d78d4e73","excerpt":"docker run \ndocker는 로컬에서 요청한 이미지가 있는지 확인한다. 이미지가 없다면 docker는 레지스트리로부터 최신의(latest) 이미지를 가져온다. 만약 최신의 이미지가 아니라면 :로 별도의 버전을 명시적으로 지정 해주어야 한다. 이미지를 가져온 docker…","html":"<h2>docker run</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/80f390e26844134ffaad49ce00da29d9/ee3fb/1-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.21621621621622%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABWElEQVR42n2RDW/TMBCG8///EEIwEEiAxCIKWqsmabKSLHiNk2b5aL6cuA9ysjGqCV7pfNb57r33zhb/wKAmeqWRaU4UC6q6ZVCaSfNfWObQWnM+n+fAk195Oa/tjM9Ox8ebkqtvOR/WDUkxmazHGlBK0TQNp9OJruuw2rblcDhQVdX82A89Wk84dy3Xm4R1kC/m3vJ9l3Mrao6pJE1TpJTkeY4QgizL5rtVliVxHM+Buq7nTmpUOD9L1huXKIpI5JE8eocfBIRJj54UfT8wjuMsxrZtPM9fCKdpmknM4zLysgtXjLy1JW++xrz6EvJ+lfFp2z2O/LwaM64RY9QWRbHs8Akm6Q9hPHDj3ePvf+GHkvBO8GN35P5BXzQ2MGKMmXrrmeh8qTAecP2QfeCQJJJGXLHdeYiHOeuC8MUvX6pcvBMPrHYV26hmvS/ZBCnXbsGheKnwb8LfOKxkKkpLDD8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"도커실행과정\"\n        title=\"\"\n        src=\"/static/80f390e26844134ffaad49ce00da29d9/fcda8/1-1.png\"\n        srcset=\"/static/80f390e26844134ffaad49ce00da29d9/12f09/1-1.png 148w,\n/static/80f390e26844134ffaad49ce00da29d9/e4a3f/1-1.png 295w,\n/static/80f390e26844134ffaad49ce00da29d9/fcda8/1-1.png 590w,\n/static/80f390e26844134ffaad49ce00da29d9/efc66/1-1.png 885w,\n/static/80f390e26844134ffaad49ce00da29d9/ee3fb/1-1.png 1144w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\ndocker는 로컬에서 요청한 이미지가 있는지 확인한다. 이미지가 없다면 docker는 레지스트리로부터 최신의(latest) 이미지를 가져온다. 만약 최신의 이미지가 아니라면 <image>:<tag>로 별도의 버전을 명시적으로 지정 해주어야 한다. 이미지를 가져온 docker는 해당 이미지를 격리된 환경인 컨테이너에서 실행하게 된다.</p>\n<h2>Dockerfile을 이용한 이미지 생성</h2>\n<p>그럼 이미지는 어떠게 만들면 될까?\n이미지는 수동으로 만드는 방법과 Dockerfile을 이용하는 방법이 있다.\n수동으로 이미지를 만드는 것은 기존 이미지에서 컨테이너를 실행하고, 컨테이너 내부에서 명령어를 수행한 후 빠져나와 최종상태를 새로운 이미지로 커밋(commit)하는 방법으로 이미지를 수동으로 생성 할수 있다.</p>\n<h3>1 준비</h3>\n<p>예제를 위해 간단한 어플리케이션을 생성한다.\napp.js 파일을 생성한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> http <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> os <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'os'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Kubia server starting...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token keyword\">var</span> <span class=\"token function-variable function\">handler</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">request<span class=\"token punctuation\">,</span> response</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Received request from\"</span> <span class=\"token operator\">+</span> request<span class=\"token punctuation\">.</span>connection<span class=\"token punctuation\">.</span>remoteAddress<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n    response<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    response<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"You've hit \"</span> <span class=\"token operator\">+</span> os<span class=\"token punctuation\">.</span><span class=\"token function\">hostname</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token keyword\">var</span> www <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span>handler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nwww<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">8080</code> 포트를 사용하는 간단한 웹서버이다.</p>\n<p>이제 Dockerfile 을 생성한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token instruction\"><span class=\"token keyword\">FROM</span> node:7 &lt;1></span>\n<span class=\"token instruction\"><span class=\"token keyword\">ADD</span> app.js /app.js &lt;2></span>\n<span class=\"token instruction\"><span class=\"token keyword\">ENTRYPOINT</span> [<span class=\"token string\">\"node\"</span>, <span class=\"token string\">\"app.js\"</span>] &lt;3></span></code></pre></div>\n<ul>\n<li>&#x3C;1> : node 컨테이너 이미지의 태그 7을 기본으로 하는 이미지는 만든다.</li>\n<li>&#x3C;2> : 명령을 실행한 로컬에 존재하는 app.js 파일을 이미지의 /(루트)에 app.js라는 이름으로 추가한다.</li>\n<li>&#x3C;3> : 이미지를 실행 했을때 <code class=\"language-text\">node app.js</code> 명령을 실행한다.</li>\n</ul>\n<h3>2 빌드</h3>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">docker build -t &lt;이미지 이름&gt; .</code></pre></div>\n<p>문장 끝에 <code class=\"language-text\">.</code> 에 있는 내용대로 이미지를 빌드 하라는 명령이 실행 되었다. 도커는 디렉터리 내 Dockerfile을 살펴보고 파일에 명시된 지시 사항에 근거해 이미지를 빌드한다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/101cb848f12e9a140cb069c5704322db/e8e04/1-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.08108108108109%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABpklEQVR42o2SbY+aQBSF9///o/ZD282umpqtuywbBewq6ysIg4CgMAw8m0H9YGtsT3Izyc3kyTn33rssy0iSmO12S1VVaDUcVdeKNImRZXnsN01bt3SnIbvdDlVVKKWQsmrBSjWUskZECdm+pD5xWugtoHY2m88IQ0GSpMRJSp6ljKYxX34ueTACvg02BPHRff0vYFmWxHFMeYpVnyLJqmbtCz7mHn4Yk+cH9vs9StW3I//Z0MBDUXEoZOs4CEJCIRDRtoWWUv0f8ByjkA3fX0K+9ld03rY8vIZtdU2f++cN5iRFqQopZTvroija0u71exXYH5d0rYKOVdAb1xjvKbOFx48XwZOtnWbtIvW7mM+xHRvP94mi6G/gQcKTs8OwV5jOCuN3RN/Z88uO6Folo8XlaQVBwHK5JAxDkiS5Dhw4Ce8TF9edMXr36A0T3iwXe7LEWeTovZ1vMhKiha7Xa3zfvwZs6NkFndGBx2HGvbnj0RQYQxdrGmDN8oslCCHwPK+FXQDPklWDtZBttNdpxsAWPI9jjGmO+SFxN9XFfx1TgzRYz/UTLG5MMDufS/EAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"이미지 빌드 과정\"\n        title=\"\"\n        src=\"/static/101cb848f12e9a140cb069c5704322db/fcda8/1-2.png\"\n        srcset=\"/static/101cb848f12e9a140cb069c5704322db/12f09/1-2.png 148w,\n/static/101cb848f12e9a140cb069c5704322db/e4a3f/1-2.png 295w,\n/static/101cb848f12e9a140cb069c5704322db/fcda8/1-2.png 590w,\n/static/101cb848f12e9a140cb069c5704322db/efc66/1-2.png 885w,\n/static/101cb848f12e9a140cb069c5704322db/c83ae/1-2.png 1180w,\n/static/101cb848f12e9a140cb069c5704322db/e8e04/1-2.png 1270w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ol>\n<li>명령어가 입력 되면 도커 클라이언트는 지정된 컨텐츠를 도커 데몬에 업로드 한다.</li>\n<li>도커 데몬은 리눅스 OS가 아닌경우 가상머신 내부에서 실행된 데몬이다.</li>\n<li>FROM 절에 의해 필요한 기본 이미지를 pull 한다.</li>\n<li>새로운 이미지를 만들어 낸다.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">&gt; docker build -t kubia .\nSending build context to Docker daemon  3.072kB\nStep 1/3 : FROM node:7\n7: Pulling from library/node\nad74af05f5a2: Pull complete\n2b032b8bbe8b: Pull complete\na9a5b35f6ead: Pull complete\n3245b5a1c52c: Pull complete\nafa075743392: Pull complete\n9fb9f21641cd: Pull complete\n3f40ad2666bc: Pull complete\n49c0ed396b49: Pull complete\nDigest: sha256:af5c2c6ac8bc3fa372ac031ef60c45a285eeba7bce9ee9ed66dad3a01e29ab8d\nStatus: Downloaded newer image for node:7\n---&gt; d9aed20b68a4\nStep 2/3 : ADD app.js /app.js\n---&gt; fd85960a0ec7\nStep 3/3 : ENTRYPOINT [&quot;node&quot;, &quot;app.js&quot;]\n---&gt; Running in 073b6aeff527\nRemoving intermediate container 073b6aeff527\n---&gt; 44ac3ce30230\nSuccessfully built 44ac3ce30230\nSuccessfully tagged kubia:latest\nSECURITY WARNING: You are building a Docker image from Windows against a non-Windows Docker host. All files and directories added to build context will have &#39;-rwxr-xr-x&#39; permissions. It is recommended to double check and reset permissions for sensitive files and directories.</code></pre></div>\n<p>위에서 확인 할수 있듯이 node 이미지를 pull 할때 여러개의 레이어로 pull이 되는것을 확인 할수 있다.\n하나의 이미지는 여러개의 레이어로 구성 되어 있으며, 우리는 이런 이미지를 pull받아 그위에 다른 레이어 (ADD, ENTRYPOINT…등)를 추가하여 새로운 이미지를 생성 하는 것이다.</p>\n<h3>3 이미지 확인</h3>\n<p>아래와 같이 생성된 이미지를 확인 할수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">&gt; docker images\nREPOSITORY    TAG                  IMAGE ID            CREATED             SIZE  \nkubia         latest               44ac3ce30230        53 minutes ago      660MB\nbusybox       latest               edabd795951a        3 days ago          1.22MB</code></pre></div>\n<h3>4 컨테이너 이미지 실행</h3>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">docker run &lt;옵션&gt; &lt;이미지 이름,ID&gt; &lt;명령&gt; &lt;매개변수&gt;\n&gt; docker run --name kubia-container -p 8081:8080 -d kubia</code></pre></div>\n<ul>\n<li>kubia 이미지에서 kubia-container라는 이름의 새로운 컨테이너를 실행 하도록 한다.</li>\n<li><code class=\"language-text\">-p 8081:8080</code> 는 로컬 머신의 8081포트가 컨테이너 내부의 8080포트와 매핑된다.</li>\n<li><code class=\"language-text\">-d</code>은 datached 모드이며, 데몬 모드라고도 하는데 컨테이너가 백그라운드로 실행 된다.</li>\n</ul>\n<h4>컨테이너가 정상적으로 실행 되지 않는다면?</h4>\n<p>실행한 컨테이너를 조회 해본다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">&gt; docker ps</code></pre></div>\n<p>근데 위와 같이 입력하면, 실행중인 컨테이너는 노출 되지만 실행을 멈춘 컨테이너는 노출 되지 않는다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">&gt; docker ps -a\nCONTAINER ID   IMAGE   COMMAND               CREATED         STATUS                    PORTS  NAMES\nb0681e7e4be6   kubia   &quot;node app.js&quot;         30 minutes ago  Exited (1) 54 seconds ago        kubia-container    \n8c172595487f   busybox &quot;echo &#39;Hello world&#39;&quot;  2 hours ago     Exited (0) 2 hours               gifted_hermann </code></pre></div>\n<p>위와 같이 입력 하면 멈춘 컨테이너가 노출 된다. 그리고 오래전에 실행 했던 컨테이너도 남아 있음을 확인 할수 있다.\n컨테이너를 확인을 했다면 다음 명령으로 [ 시작 | 재시작 | 중지 | 접속 | 삭제 | 상세 정보 조회 ]가 가능하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">docker [start | restart | stop | attach | rm | inspect ] &lt;컨테이너 이름 혹은 아이디&gt;</code></pre></div>\n<h3>5 컨테이너 내부에서 shell 실행하기</h3>\n<p>아래 명령을 이용하여  bash shell을 실행한다.  (어떤 명령어들은 TERM 변수가 선언되지 않아 에러가 난다)</p>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">docker exec -it kubia-container bash</code></pre></div>\n<p>옵션 설명\n* -i : 표준 입력(STDIN)을 오픈 상태로 유지한다. shell에 명령어를 입력하기 위해 필요하다.\n* -t : 의사(pseudo) 터미널(tty)를 할당한다. 입력하지 않으면 프로픔트가 화면에 표시 되지 않는다.</p>\n<h2>참고</h2>\n<ul>\n<li>쿠버네티스 인 액션</li>\n</ul>","frontmatter":{"title":"Docker로 어플리케이션 실행하기","date":"September 04, 2020","description":"Docker를 이용해서 간단한 어플리케이션을 빌드하고, 실행 해본다."}}},"pageContext":{"slug":"/dockerExecution/","previous":{"fields":{"slug":"/addGoogleAnalyticsForGatsbyJS/"},"frontmatter":{"title":"GatsbyJS에 GoogleAnalytics (방문자 통계) 추가하기"}},"next":{"fields":{"slug":"/kotlinCast/"},"frontmatter":{"title":"코틀린의 캐스트"}}}},"staticQueryHashes":["2833426266","2841359383"],"slicesMap":{}}